<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>rdflib Introduction • rdflib</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rdflib</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/rdflib.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cboettig/rdflib">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
<script src="http://code.jquery.com/jquery-2.1.2.min.js"></script><script src="http://cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script><script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable();
         } );
</script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>rdflib Introduction</h1>
                        <h4 class="author">Carl Boettiger</h4>
            
            <h4 class="date">2017-12-11</h4>
          </div>

    
    
<div class="contents">
<p><code>rdflib</code> is really just a lightweight wrapper around two existing R packages: <code>redland</code>, and <code>jsonld</code>, which themselves are (less trivial) wrappers around existing libraries (the redland C library, and the JSON-LD javascript implementation) which themselves are instances of a set of W3C Standards for the representation of linked data. <code>rdflib</code> has two key features: a simpler, higher-level interface for the common tasks performed in the <code>redland</code> library (user does not have to manage <code>world</code>, <code>model</code> and <code>storage</code> objects by default just to perform standard operations and conversions), and integration between the now popular <code>json-ld</code> serialization, which is not part of the <code>redland</code> library.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rdflib)
<span class="kw">library</span>(magrittr) <span class="co"># pipes</span>

## JSON toolkit 
<span class="kw">library</span>(jsonld)
<span class="kw">library</span>(jsonlite)
<span class="kw">library</span>(jqr)

## For accessing some remote data sources
<span class="kw">library</span>(httr)
<span class="kw">library</span>(xml2)
<span class="kw">library</span>(readr)

## for some typical data processing
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(lubridate)</code></pre></div>
<div id="sparql-queries-on-json-ld-data" class="section level2">
<h2 class="hasAnchor">
<a href="#sparql-queries-on-json-ld-data" class="anchor"></a>SPARQL queries on JSON-LD data</h2>
<p>One example of this utility is the ability to perform graph queries using SPARQL on JSON-LD datasets. The SPARQL query language is analgous to other query languages such as SQL, but instead of working on an existing set of tables in a relational database, we can query data from a triplestore.</p>
<p>This is sometimes called “schema on read”, since our query will define the schema (i.e. the structure or skeleton of the <code>data.frame</code>) our data is returned in. Because SPARQL is a graph query language, this makes it easy to construct a query that would be cumbersome in SQL or even other recursive tree queries like <code>jq</code>, which both would require some knowledge of how the stored data is organized.</p>
<p>To illustrate this, consider the following example. NSF asks me to list all of my co-authors within the past four years as conflicts of interest (COI). Here is a query that for all papers where I am an author, returns a table of given name, family name and year of publication:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ex &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/vita.json"</span>, <span class="dt">package=</span><span class="st">"rdflib"</span>)
vita &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rdf_parse.html">rdf_parse</a></span>(ex, <span class="st">"jsonld"</span>)

sparql &lt;-
<span class="st"> 'PREFIX schema: &lt;http://schema.org/&gt;</span>

<span class="st">  SELECT ?coi_given ?coi_family ?year</span>

<span class="st">  WHERE { </span>
<span class="st">    ?paper a schema:ScholarlyArticle . </span>
<span class="st">    ?paper schema:author ?authors .</span>
<span class="st">    ?paper schema:dateCreated ?year . </span>
<span class="st">    ?authors schema:familyName ?coi_family .</span>
<span class="st">    OPTIONAL { ?authors schema:givenName ?coi_given . }</span>

<span class="st">    FILTER ( ?coi_family != "Boettiger" )</span>
<span class="st">}</span>
<span class="st">'</span>

coi &lt;-<span class="st"> </span>vita <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/rdf_query.html">rdf_query</a></span>(sparql)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">coi_given</th>
<th align="left">coi_family</th>
<th align="left">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">David</td>
<td align="left">O’Sullivan</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Paolo</td>
<td align="left">D’Odorico</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Laurel</td>
<td align="left">Larsen</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Samuel D.</td>
<td align="left">Chamberlain</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Stephanie S.</td>
<td align="left">“Roma0F1ach”</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Sadie J.</td>
<td align="left">Ryan</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Luca</td>
<td align="left">Giuggioli</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Colin J.</td>
<td align="left">Carlson</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Charles R.</td>
<td align="left">Marshall</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Wayne M.</td>
<td align="left">Getz</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Karthik</td>
<td align="left">Ram</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="even">
<td align="left">Ted</td>
<td align="left">Harte</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="odd">
<td align="left">Scott</td>
<td align="left">Chamberlain</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="even">
<td align="left">Paul R.</td>
<td align="left">Armsworth</td>
<td align="left">2016-5-6</td>
</tr>
<tr class="odd">
<td align="left">Alan</td>
<td align="left">Hastings</td>
<td align="left">2016-5-6</td>
</tr>
<tr class="even">
<td align="left">Jacob</td>
<td align="left">LaRiviere</td>
<td align="left">2016-5-6</td>
</tr>
<tr class="odd">
<td align="left">James N.</td>
<td align="left">Sanchirico</td>
<td align="left">2016-5-6</td>
</tr>
<tr class="even">
<td align="left">Michael</td>
<td align="left">Bode</td>
<td align="left">2016-5-6</td>
</tr>
<tr class="odd">
<td align="left">Duncan</td>
<td align="left">Temple Lang</td>
<td align="left">2012-10-11</td>
</tr>
<tr class="even">
<td align="left">Brian C.</td>
<td align="left">“O019Meara”</td>
<td align="left">2012-3-13</td>
</tr>
<tr class="odd">
<td align="left">Dwueng-Chwuan</td>
<td align="left">Jhwueng</td>
<td align="left">2012-3-13</td>
</tr>
<tr class="even">
<td align="left">Jeremy M.</td>
<td align="left">Beaulieu</td>
<td align="left">2012-3-13</td>
</tr>
<tr class="odd">
<td align="left">Peter</td>
<td align="left">Ralph</td>
<td align="left">2012-2-19</td>
</tr>
<tr class="even">
<td align="left">Graham</td>
<td align="left">Coop</td>
<td align="left">2012-2-19</td>
</tr>
<tr class="odd">
<td align="left">P. C.</td>
<td align="left">Wainwright</td>
<td align="left">2012-11-6</td>
</tr>
<tr class="even">
<td align="left">D. T.</td>
<td align="left">Lang</td>
<td align="left">2012-11-6</td>
</tr>
<tr class="odd">
<td align="left">Hilmar</td>
<td align="left">Lapp</td>
<td align="left">2015-9-3</td>
</tr>
<tr class="even">
<td align="left">Rutger</td>
<td align="left">Vos</td>
<td align="left">2015-9-3</td>
</tr>
<tr class="odd">
<td align="left">Scott</td>
<td align="left">Chamberlain</td>
<td align="left">2015-9-3</td>
</tr>
<tr class="even">
<td align="left">S.</td>
<td align="left">Munch</td>
<td align="left">2015-1-7</td>
</tr>
<tr class="odd">
<td align="left">M.</td>
<td align="left">Mangel</td>
<td align="left">2015-1-7</td>
</tr>
<tr class="even">
<td align="left">Alan</td>
<td align="left">Hastings</td>
<td align="left">2013-7-10</td>
</tr>
<tr class="odd">
<td align="left">Alan</td>
<td align="left">Hastings</td>
<td align="left">2012-10-10</td>
</tr>
<tr class="even">
<td align="left">Alan</td>
<td align="left">Hastings</td>
<td align="left">2012-5-16</td>
</tr>
<tr class="odd">
<td align="left">Juliann E.</td>
<td align="left">Aukema</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Stephanie G.</td>
<td align="left">Labou</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Tracy K.</td>
<td align="left">Teal</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Ethan P.</td>
<td align="left">White</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Amber</td>
<td align="left">Budden</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Denny S.</td>
<td align="left">“Fern0E1ndez”</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Louis J.</td>
<td align="left">Gross</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Scott L.</td>
<td align="left">Collins</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Rebecca R.</td>
<td align="left">Hernandez</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Julien</td>
<td align="left">Brun</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Sarah R.</td>
<td align="left">Supp</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Mark P.</td>
<td align="left">Schildhauer</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Leah A.</td>
<td align="left">Wasser</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Matthew B.</td>
<td align="left">Jones</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Stephanie E.</td>
<td align="left">Hampton</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Philip F.</td>
<td align="left">Hopkins</td>
<td align="left">2006-11-27</td>
</tr>
<tr class="odd">
<td align="left">Paul</td>
<td align="left">Bode</td>
<td align="left">2006-11-27</td>
</tr>
<tr class="even">
<td align="left">Neta A.</td>
<td align="left">Bahcall</td>
<td align="left">2006-11-27</td>
</tr>
<tr class="odd">
<td align="left">James J.</td>
<td align="left">Wray</td>
<td align="left">2006-11-27</td>
</tr>
<tr class="even">
<td align="left">Alan</td>
<td align="left">Hastings</td>
<td align="left">2013-01-08</td>
</tr>
<tr class="odd">
<td align="left">Joshua S.</td>
<td align="left">Weitz</td>
<td align="left">2009-10-19</td>
</tr>
<tr class="even">
<td align="left">Jonathan</td>
<td align="left">Dushoff</td>
<td align="left">2009-10-19</td>
</tr>
<tr class="odd">
<td align="left">Alan</td>
<td align="left">Hastings</td>
<td align="left">2013-6-20</td>
</tr>
<tr class="even">
<td align="left">Noam</td>
<td align="left">Ross</td>
<td align="left">2013-6-20</td>
</tr>
<tr class="odd">
<td align="left">Benjamin L.</td>
<td align="left">Phillips</td>
<td align="left">2016-8-19</td>
</tr>
<tr class="even">
<td align="left">T. Alex</td>
<td align="left">Perkins</td>
<td align="left">2016-8-19</td>
</tr>
</tbody>
</table>
<p>Now we have rectangular data, we can tidy things up a bit more. (In principle I believe we could have done this in SPARQL as well)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coi2 &lt;-<span class="st"> </span>
<span class="st">  </span>coi <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>## join names, year as Date
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">year =</span> <span class="kw">as.Date</span>(year), <span class="dt">name =</span> <span class="kw">paste</span>(coi_given, coi_family)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>## interaction in last 4 years
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(year <span class="op">&gt;</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/lubridate/topics/today">today</a></span>() <span class="op">-</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/lubridate/topics/period">years</a></span>(<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>## For each person, list only most recent date
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">year =</span> <span class="kw">max</span>(year)) </code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alan Hastings</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="even">
<td align="left">Amber Budden</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Benjamin L. Phillips</td>
<td align="left">2016-08-19</td>
</tr>
<tr class="even">
<td align="left">Charles R. Marshall</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Colin J. Carlson</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">David O’Sullivan</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Denny S. “Fern0E1ndez”</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Ethan P. White</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Hilmar Lapp</td>
<td align="left">2015-09-03</td>
</tr>
<tr class="even">
<td align="left">Jacob LaRiviere</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="odd">
<td align="left">James N. Sanchirico</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="even">
<td align="left">Juliann E. Aukema</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Julien Brun</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Karthik Ram</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="odd">
<td align="left">Laurel Larsen</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Leah A. Wasser</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Louis J. Gross</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Luca Giuggioli</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">M. Mangel</td>
<td align="left">2015-01-07</td>
</tr>
<tr class="even">
<td align="left">Mark P. Schildhauer</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Matthew B. Jones</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Michael Bode</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="odd">
<td align="left">Paolo D’Odorico</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Paul R. Armsworth</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="odd">
<td align="left">Rebecca R. Hernandez</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Rutger Vos</td>
<td align="left">2015-09-03</td>
</tr>
<tr class="odd">
<td align="left">S. Munch</td>
<td align="left">2015-01-07</td>
</tr>
<tr class="even">
<td align="left">Sadie J. Ryan</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Samuel D. Chamberlain</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Sarah R. Supp</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Scott Chamberlain</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="even">
<td align="left">Scott L. Collins</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Stephanie E. Hampton</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Stephanie G. Labou</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Stephanie S. “Roma0F1ach”</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">T. Alex Perkins</td>
<td align="left">2016-08-19</td>
</tr>
<tr class="odd">
<td align="left">Ted Harte</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="even">
<td align="left">Tracy K. Teal</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Wayne M. Getz</td>
<td align="left">2017-12-09</td>
</tr>
</tbody>
</table>
<p>Yay, that’s wasn’t so bad. Rectangling JSON without a graph query is not as easy. This can be immensely frustrating to do using basic iteration operations with <code>purrr</code>, even with it’s powerful syntax. Rectangling is a bit better with a tree-based query language, like a <code>jq</code> query. The only limitation here is that we have to know just a little about how our data is structured, since there are multiple tree structures that correspond to the same graph (or we could just use JSON-LD frame first, but that adds another step in the puzzle.)</p>
<p>Here’s the same extraction on the same data, but with a <code>jq</code> query:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coi_jq &lt;-<span class="st"> </span>
<span class="st">  </span>readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_file">read_file</a></span>(ex) <span class="op">%&gt;%</span>
<span class="st">  </span>jqr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/jqr/topics/jq">jq</a></span>(
     <span class="st">'."@reverse".author[]  | </span>
<span class="st">       { year: .dateCreated, </span>
<span class="st">         author: .author[] | [.givenName, .familyName]  | join(" ")</span>
<span class="st">       }'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>jqr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/jqr/topics/combine">combine</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span>jsonlite<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonlite/topics/fromJSON">fromJSON</a></span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coi3 &lt;-<span class="st"> </span>
<span class="st">  </span>coi_jq <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">year =</span> <span class="kw">as.Date</span>(year)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(year <span class="op">&gt;</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/lubridate/topics/today">today</a></span>() <span class="op">-</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/lubridate/topics/period">years</a></span>(<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw">grepl</span>(<span class="st">"Boettiger"</span>, author)) <span class="op">%&gt;%</span>
<span class="st">  </span>## For each person, list only most recent date
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(author) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">year =</span> <span class="kw">max</span>(year))  </code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">author</th>
<th align="left">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alan Hastings</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="even">
<td align="left">Amber Budden</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Benjamin L. Phillips</td>
<td align="left">2016-08-19</td>
</tr>
<tr class="even">
<td align="left">Charles R. Marshall</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Colin J. Carlson</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">David O’Sullivan</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Denny S. Fernández</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Ethan P. White</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Hilmar Lapp</td>
<td align="left">2015-09-03</td>
</tr>
<tr class="even">
<td align="left">Jacob LaRiviere</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="odd">
<td align="left">James N. Sanchirico</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="even">
<td align="left">Juliann E. Aukema</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Julien Brun</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Karthik Ram</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="odd">
<td align="left">Laurel Larsen</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Leah A. Wasser</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Louis J. Gross</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Luca Giuggioli</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">M. Mangel</td>
<td align="left">2015-01-07</td>
</tr>
<tr class="even">
<td align="left">Mark P. Schildhauer</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Matthew B. Jones</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Michael Bode</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="odd">
<td align="left">Paolo D’Odorico</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Paul R. Armsworth</td>
<td align="left">2016-05-06</td>
</tr>
<tr class="odd">
<td align="left">Rebecca R. Hernandez</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Rutger Vos</td>
<td align="left">2015-09-03</td>
</tr>
<tr class="odd">
<td align="left">S. Munch</td>
<td align="left">2015-01-07</td>
</tr>
<tr class="even">
<td align="left">Sadie J. Ryan</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="odd">
<td align="left">Samuel D. Chamberlain</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">Sarah R. Supp</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Scott Chamberlain</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="even">
<td align="left">Scott L. Collins</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Stephanie E. Hampton</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="even">
<td align="left">Stephanie G. Labou</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Stephanie S. Romañach</td>
<td align="left">2017-12-09</td>
</tr>
<tr class="even">
<td align="left">T. Alex Perkins</td>
<td align="left">2016-08-19</td>
</tr>
<tr class="odd">
<td align="left">Ted Harte</td>
<td align="left">2015-11-16</td>
</tr>
<tr class="even">
<td align="left">Tracy K. Teal</td>
<td align="left">2017-03-15</td>
</tr>
<tr class="odd">
<td align="left">Wayne M. Getz</td>
<td align="left">2017-12-09</td>
</tr>
</tbody>
</table>
</div>
<div id="turning-rdf-xml-into-more-friendly-json" class="section level2">
<h2 class="hasAnchor">
<a href="#turning-rdf-xml-into-more-friendly-json" class="anchor"></a>Turning RDF-XML into more friendly JSON</h2>
<p><code>rdflib</code> can also be useful as quick and lossless way to convert parse common data formats (e.g. RDF XML) into something more R-friendly. In this vignette, we illustrate how this might work in a simple example of some citation data returned in RDF-XML format from CrossRef.</p>
<p>Let’s begin by reading in some <code>RDF+XML</code> data from CrossRef by querying a DOI and requesting <code>rdf+xml</code> return type (via Content Negotiation):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">"http://dx.doi.org/10.1002/ece3.2314"</span> <span class="op">%&gt;%</span>
<span class="st">  </span>httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/GET">GET</a></span>(httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/add_headers">add_headers</a></span>(<span class="dt">Accept=</span><span class="st">"application/rdf+xml"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/content">content</a></span>(<span class="dt">as =</span> <span class="st">"parsed"</span>, <span class="dt">type =</span> <span class="st">"application/xml"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>xml2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/xml2/topics/write_xml">write_xml</a></span>(<span class="st">"ex.xml"</span>)</code></pre></div>
<p>Our <code>rdflib</code> functions perform the simple task of parsing this <code>rdfxml</code> file into R (as a <code>redland</code> <code>rdf</code> class object) and then writing it back out in <code>jsonld</code> serialization:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/rdf_parse.html">rdf_parse</a></span>(<span class="st">"ex.xml"</span>, <span class="st">"rdfxml"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/rdf_serialize.html">rdf_serialize</a></span>(<span class="st">"ex.json"</span>, <span class="st">"jsonld"</span>)</code></pre></div>
<p>and we now have JSON file. We can clean this file up a bit by replacing the long URIs with short prefixes by “compacting” the file into a specific JSON-LD context. FOAF, OWL, and Dublin Core are all recognized by schema.org, so we need not declare them at all here. PRISM and BIBO ontologies are not, so we simply declare them as additional prefixes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">context &lt;-<span class="st"> </span>
<span class="st">'{ "@context": [</span>
<span class="st">    "http://schema.org",</span>
<span class="st">  {</span>
<span class="st">    "prism": "http://prismstandard.org/namespaces/basic/2.1/",</span>
<span class="st">    "bibo": "http://purl.org/ontology/bibo/"</span>
<span class="st">  }]</span>
<span class="st">}'</span>
json &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonld/topics/jsonld">jsonld_compact</a></span>(<span class="st">"ex.json"</span>, context)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#sparql-queries-on-json-ld-data">SPARQL queries on JSON-LD data</a></li>
      <li><a href="#turning-rdf-xml-into-more-friendly-json">Turning RDF-XML into more friendly JSON</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
